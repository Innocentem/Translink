<!DOCTYPE html>
<html lang="en">

<head>
  <title>Dashboard</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Fonts and Stylesheets -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="../static/css/open-iconic-bootstrap.min.css">
  <link rel="stylesheet" href="../static/css/animate.css">
  <link rel="stylesheet" href="../static/css/owl.carousel.min.css">
  <link rel="stylesheet" href="../static/css/owl.theme.default.min.css">
  <link rel="stylesheet" href="../static/css/magnific-popup.css">
  <link rel="stylesheet" href="../static/css/aos.css">
  <link rel="stylesheet" href="../static/css/ionicons.min.css">
  <link rel="stylesheet" href="../static/css/bootstrap-datepicker.css">
  <link rel="stylesheet" href="../static/css/jquery.timepicker.css">
  <link rel="stylesheet" href="../static/css/flaticon.css">
  <link rel="stylesheet" href="../static/css/icomoon.css">
  <link rel="stylesheet" href="../static/css/style.css">
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
    <div class="container">
      <a class="navbar-brand" href="{{ url_for('landing') }}">Trans<span>Link</span></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav"
        aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="oi oi-menu"></span> Menu
      </button>

      <div class="collapse navbar-collapse" id="ftco-nav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item"><a href="{{ url_for('browse') }}" class="nav-link">Browse</a></li>
          <li class="nav-item"><a href="#" class="nav-link" data-toggle="modal" data-target="#postTruckModal">Add
              Truck</a></li>
          <li class="nav-item"><a href="#" class="nav-link" data-toggle="modal" data-target="#postCargoModal">Request
              Truck</a></li>
          <li class="nav-item"><a href="{{ url_for('logout') }}" class="nav-link">Logout</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- END Navbar -->

  <!-- Hero Section -->
  <section class="hero-wrap hero-wrap-2 js-fullheight"
    style="background-image: url('../static/images/traffic-highway.jpg');" data-stellar-background-ratio="0.5">
    <div class="overlay"></div>
    <div class="container">
      <div class="row no-gutters slider-text js-fullheight align-items-end justify-content-start">
        <div class="col-md-9 ftco-animate pb-5">
          <p class="breadcrumbs">
            <span class="mr-2"><a href="{{ url_for('landing') }}">Home <i class="ion-ios-arrow-forward"></i></a></span>
            <span>Dashboard <i class="ion-ios-arrow-forward"></i></span>
          </p>
          <div class="container mt-4">
            <div class="row">
              <div class="col-md-3 text-center">
                <!-- Display User Avatar -->
                {% if user_avatar %}
                <img src="{{ url_for('static', filename='uploads/' + user_avatar) }}" alt="User Avatar"
                  class="img-fluid rounded-circle" style="width: 80px; height: 80px;">
                {% else %}
                <img src="{{ url_for('static', filename='uploads/default-avatar.png') }}" alt="Default Avatar"
                  class="img-fluid rounded-circle" style="width: 80px; height: 80px;">
                {% endif %}
              </div>
              <div class="col-md-9">
                <h1 class="mb-3 bread">{{ current_user.username }}</h1>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Trucks Section -->
  <section class="ftco-section">
    <div class="container">
      <div class="row mb-5">
        <div class="col-12">
          <h2 class="section-title text-center">Your Trucks</h2>
        </div>
      </div>
      <div class="row d-flex justify-content-center">
        {% for truck in current_user.trucks %}
        <div class="col-md-6 col-lg-4 mb-4 d-flex ftco-animate">
          <div class="card shadow-sm">
            <div class="card-img-top"
              style="background-image: url('{{ url_for('static', filename='uploads/' + truck.image) }}'); height: 200px; background-size: cover; background-position: center;">
            </div>
            <div class="card-body">
              <h5 class="card-title">{{ truck.name }}</h5>
              <p class="card-text">Routes: {{ truck.routes }}</p>
              <p>
                <span class="badge {% if truck.available %}bg-success{% else %}bg-danger{% endif %}">
                  {% if truck.available %}Available{% else %}Booked{% endif %}
                </span>
              </p>
              <form action="{{ url_for('toggle_availability', truck_id=truck.id) }}" method="POST" class="d-inline">
                <button type="submit" class="btn btn-info btn-sm">
                  {% if truck.available %}Mark as Booked{% else %}Mark as Available{% endif %}
                </button>
              </form>
              <form action="{{ url_for('delete_truck', truck_id=truck.id) }}" method="POST" class="d-inline">
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
              </form>
            </div>
          </div>
        </div>
        {% else %}
        <p class="text-center">You have no trucks listed. Add one using the "Add Truck" button above.</p>
        {% endfor %}
      </div>
    </div>
  </section>

  <!-- Cargo Section -->
  <section class="ftco-section">
    <div class="container">
      <div class="row mb-5">
        <div class="col-12">
          <h2 class="section-title text-center">Your Cargo</h2>
        </div>
      </div>
      <div class="row d-flex justify-content-center">
        {% for cargo in current_user.cargos %}
        <div class="col-md-6 col-lg-4 mb-4 d-flex ftco-animate">
          <div class="card shadow-sm">
            <div class="card-img-top"
              style="background-image: url('{{ url_for('static', filename='uploads/' + cargo.image) }}'); height: 200px; background-size: cover; background-position: center;">
            </div>
            <div class="card-body">
              <h5 class="card-title">{{ cargo.name }}</h5>
              <p class="card-text">Route: {{ cargo.origin }} to {{ cargo.destination }}</p>
              <p class="card-text">Weight: {{ cargo.weight }} kg</p>
              <p>
                <span class="badge {% if cargo.status == 'Available' %}bg-success{% else %}bg-danger{% endif %}">
                  {{ cargo.status }}
                </span>
              </p>
              <form action="{{ url_for('toggle_cargo_status', cargo_id=cargo.id) }}" method="POST" class="d-inline">
                <button type="submit" class="btn btn-info btn-sm">
                  {% if cargo.status == 'Available' %}Mark as Transported{% else %}Mark as Available{% endif %}
                </button>
              </form>
              <form action="{{ url_for('delete_cargo', cargo_id=cargo.id) }}" method="POST" class="d-inline">
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
              </form>
            </div>
          </div>
        </div>
        {% else %}
        <p class="text-center">You have no cargo listed. Add one using the "Add Cargo" button above.</p>
        {% endfor %}
      </div>
    </div>
  </section>
  <!-- Truck Requests Section -->
  <h2>Truck Requests</h2>
  <table class="table">
    <thead>
      <tr>
        <th>Requester</th>
        <th>Truck</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for request in current_user.truck_requests %}
      <tr>
        <td>{{ request.requester.username }}</td>
        <td>{{ request.truck.name }}</td>
        <td>{{ request.status }}</td>
        <td>
          {% if request.status == 'Pending' %}
          <a href="{{ url_for('approve_request', request_id=request.id) }}" class="btn btn-success">Approve</a>
          <a href="{{ url_for('decline_request', request_id=request.id) }}" class="btn btn-danger">Decline</a>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <hr>

  <!-- Footer -->
  <footer class="ftco-footer ftco-bg-dark ftco-section">
    <div class="container">
      <div class="row mb-5">
        <div class="col-md">
          <div class="ftco-footer-widget mb-4">
            <h2 class="ftco-heading-2">About TransLink</h2>
            <p>TransLink is your trusted partner in seamless cargo transportation. We connect shippers with reliable
              truck drivers, making it easier to transport goods efficiently and affordably.</p>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px">
      <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee" />
      <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
        stroke="#F96D00" />
    </svg></div>


  <!-- jQuery should always come first -->
  <script src="../static/js/jquery.min.js"></script>
  <script src="../static/js/jquery-migrate-3.0.1.min.js"></script>

  <!-- Popper.js before Bootstrap (required for Bootstrap tooltips/popovers) -->
  <script src="../static/js/popper.min.js"></script>
  <script src="../static/js/bootstrap.min.js"></script>

  <!-- Utility libraries (animations, easing, waypoints) -->
  <script src="../static/js/jquery.easing.1.3.js"></script>
  <script src="../static/js/jquery.waypoints.min.js"></script>
  <script src="../static/js/jquery.stellar.min.js"></script>
  <script src="../static/js/scrollax.min.js"></script>

  <!-- UI Components -->
  <script src="../static/js/owl.carousel.min.js"></script>
  <script src="../static/js/jquery.magnific-popup.min.js"></script>
  <script src="../static/js/aos.js"></script>
  <script src="../static/js/jquery.animateNumber.min.js"></script>
  <script src="../static/js/bootstrap-datepicker.js"></script>
  <script src="../static/js/jquery.timepicker.min.js"></script>

  <!-- Google Maps (external script should come before dependent script) -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
  <script src="../static/js/google-map.js"></script>

  <!-- Main script (should be last to ensure everything else is loaded) -->
  <script src="../static/js/main.js"></script>
  <!-- post cargo modal Structure -->
  <div class="modal fade" id="postCargoModal" tabindex="-1" aria-labelledby="postCargoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="postCargoModalLabel">What do you want to transfer</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form method="POST" enctype="multipart/form-data">
            {{ cargo_form.hidden_tag() }}

            <div class="mb-3">
              <label for="name" class="form-label">{{ cargo_form.name.label }}</label>
              {{ cargo_form.name(class="form-control") }}
              {% if cargo_form.name.errors %}
              <div class="text-danger">{{ cargo_form.name.errors[0] }}</div>
              {% endif %}
            </div>

            <div class="mb-3">
              <label for="weight" class="form-label">{{ cargo_form.weight.label }}</label>
              {{ cargo_form.weight(class="form-control") }}
              {% if cargo_form.weight.errors %}
              <div class="text-danger">{{ cargo_form.weight.errors[0] }}</div>
              {% endif %}
            </div>

            <div class="mb-3">
              <label for="origin" class="form-label">{{ cargo_form.origin.label }}</label>
              {{ cargo_form.origin(class="form-control") }}
              {% if cargo_form.origin.errors %}
              <div class="text-danger">{{ cargo_form.origin.errors[0] }}</div>
              {% endif %}
            </div>

            <div class="mb-3">
              <label for="destination" class="form-label">{{ cargo_form.destination.label }}</label>
              {{ cargo_form.destination(class="form-control") }}
              {% if cargo_form.destination.errors %}
              <div class="text-danger">{{ cargo_form.destination.errors[0] }}</div>
              {% endif %}
            </div>

            <div class="mb-3">
              <label for="image" class="form-label">{{ cargo_form.image.label }}</label>
              {{ cargo_form.image(class="form-control") }}
              {% if cargo_form.image.errors %}
              <div class="text-danger">{{ cargo_form.image.errors[0] }}</div>
              {% endif %}
            </div>

            <button type="submit" name="submit_cargo" class="btn btn-primary w-100">{{ cargo_form.submit.label
              }}</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  <!--post truck Modal Structure -->
  <div class="modal fade" id="postTruckModal" tabindex="-1" role="dialog" aria-labelledby="postTruckModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="postTruckModalLabel">Post New Truck</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- Post Truck Form -->
          <form method="POST" enctype="multipart/form-data">
            {{ truck_form.hidden_tag() }}

            <div class="mb-3">
              <label for="name" class="form-label">{{ truck_form.name.label }}</label>
              {{ truck_form.name(class="form-control") }}
              {% if truck_form.name.errors %}
              <div class="text-danger">{{ truck_form.name.errors[0] }}</div>
              {% endif %}
            </div>

            <div class="mb-3">
              <label for="routes" class="form-label">{{ truck_form.routes.label }}</label>
              {{ truck_form.routes(class="form-control") }}
              {% if truck_form.routes.errors %}
              <div class="text-danger">{{ truck_form.routes.errors[0] }}</div>
              {% endif %}
            </div>

            <div class="mb-3">
              <label for="image" class="form-label">{{ truck_form.image.label }}</label>
              {{ truck_form.image(class="form-control") }}
              {% if truck_form.image.errors %}
              <div class="text-danger">{{ truck_form.image.errors[0] }}</div>
              {% endif %}
            </div>

            <button type="submit" name="submit_truck" class="btn btn-primary w-100">{{ truck_form.submit.label
              }}</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</body>

</html>